    :root { --bg:#f6f8fb; --panel:#fff; --accent:#2b8cff; --muted:#6b7280; --border:#111; --ai:#f3f6ff; --user:#2b8cff; }
    *{box-sizing:border-box}
    html, body { height:100%; }
    body { font-family:Inter, Arial,Helvetica,sans-serif; background:var(--bg); margin:0; padding:16px; color:#111; height:100vh; overflow:hidden; }

    .container { max-width:1500px; margin:0 auto; display:flex; gap:16px; height:100%; align-items:flex-start }
    .left-column { flex:1 1 auto; min-width:0; height:100%; overflow:auto; }

    .top { display:flex; gap:12px; align-items:center; margin-bottom:12px }
    .label { font-weight:700; min-width:120px; font-size:1.05rem }

    .input-wrap { position:relative; flex:1; min-width:0; display:flex; gap:8px; align-items:center }
    .input-wrap input,
    input[type="text"],
    input[list] {
      width:100%;
      padding:12px 18px;
      border-radius:999px;
      border:2px solid #e6e9ef;
      background:#fff;
      font-size:1rem;
      display:block;
      box-sizing:border-box;
      outline: none;
    }

    button { padding:10px 14px; border-radius:12px; border:none; cursor:pointer; font-weight:700 }
    button.primary { background:var(--accent); color:#fff }

    .cols-dropdown {
      position:absolute;
      left:0;
      top:calc(100% + 8px);
      width:100%;
      max-height:260px;
      overflow:auto;
      background:#fff;
      border-radius:10px;
      border:1px solid rgba(16,24,40,0.06);
      box-shadow:0 12px 30px rgba(8,20,40,0.08);
      z-index:1200;
      padding:6px;
    }
    .col-option {
      padding:10px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      color:#111;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .col-option:hover, .col-option[aria-selected="true"] {
      background:linear-gradient(90deg,#e6f0ff,#ffffff);
      color:var(--accent);
    }
    .cols-empty {
      padding:12px;
      color:var(--muted);
      text-align:center;
      font-size:0.95rem;
    }

    .main { display:flex; gap:16px; height: calc(100% - 64px); }
    .left { width:200px; background:transparent; padding:0; display:flex; flex-direction:column; gap:10px; align-items:flex-start }
    .btn-list { display:flex; flex-direction:column; gap:12px; width:100% }
    .type-btn { width:100%; padding:14px; border-radius:8px; border:3px solid var(--border); background:#fff; text-align:center; cursor:pointer; font-weight:700 }
    .type-btn.active { background:linear-gradient(90deg,#e6f0ff,#ffffff); border-color:var(--accent); color:var(--accent) }

    .canvas { background:var(--panel); padding:12px; border-radius:12px; border:2px solid #111; box-shadow:0 6px 18px rgba(12,40,80,0.06); display:flex; flex-direction:column; flex:1; height: calc(100vh - 120px); max-height: calc(100vh - 120px); overflow: hidden; }

    .canvas .header { display:flex; justify-content:space-between; align-items:center; gap:12px }

    .plot-area { margin-top:12px; border:none; border-radius:6px; display:flex; align-items:center; justify-content:center; padding:6px; background:#fff; width:100%; height: calc(100% - 48px); overflow:auto; }
    .plot-area > div { width:100%; display:flex; align-items:center; justify-content:center; flex-direction:column; }
    .plot-area img { width:100%; height:auto; max-height:100%; display:block; object-fit:contain; }

    .left-column, .main { padding:0; } .canvas { padding-left:16px; padding-right:16px; }

    @media (max-width:1100px) { .container { padding:12px } .left { width:160px } .plot-area { min-height:200px; max-height:260px } }

    .ai-fab { position: fixed; right: 22px; bottom: 22px; width: 72px; height: 72px; border-radius: 50%; background: linear-gradient(180deg,var(--user),#276be0); color: #fff; border: none; box-shadow: 0 8px 24px rgba(18,60,120,0.18); font-weight:700; cursor: button; z-index: 1400; display:flex; align-items:center; justify-content:center; font-size:16px; transition: transform .18s ease; }
    .ai-fab:active { transform: scale(.97); }

    .chat-overlay { position: fixed; inset: 0; background: rgba(8,12,20,0.0); z-index: 1350; display: flex; align-items: flex-end; justify-content: flex-end; padding: 18px; pointer-events: auto; transition: background .22s ease, opacity .22s ease; opacity: 0; }

    .chat-popup { width: 360px; max-width: calc(100% - 36px); height: 460px; max-height: calc(100vh - 40px); background: var(--panel); border-radius: 14px; box-shadow: 0 18px 40px rgba(8,20,40,0.25); display: flex; flex-direction: column; overflow: hidden; z-index: 1401; transform: scale(.92); opacity: 0; transition: transform .22s cubic-bezier(.2,.9,.3,1), opacity .22s ease; transform-origin: bottom right; margin-bottom: calc(72px + 18px); }

    .chat-popup .chat-popup-header { display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom: 1px solid rgba(0,0,0,0.06); }
    .chat-popup .close-btn { background: transparent; border: none; font-weight:700; cursor:pointer; padding:6px 10px; border-radius:8px; font-size:20px; line-height:1; color:var(--muted); }
    .chat-popup .close-btn:hover { color:#111; }

    .chat-popup .messages { flex: 1 1 auto; min-height: 0; overflow: auto; padding: 12px; display:flex; flex-direction:column; gap:10px; }

    .message-row { display:flex; align-items:flex-start; margin:6px 0; }
    .message-row.bot { justify-content:flex-start; }
    .message-row.user { justify-content:flex-end; }

    .bubble { padding:10px 14px; border-radius:14px; font-size:0.95rem; line-height:1.38; max-width:72%; box-shadow:0 6px 14px rgba(12,40,80,0.04); word-wrap:break-word; }
    .message-row.bot .bubble { margin-right: auto; border-radius:14px 14px 14px 6px; }
    .message-row.user .bubble { margin-left: auto; border-radius:14px 14px 6px 14px; }
    .bubble.bot { background:var(--ai); color:#0b1b3a; }
    .bubble.user { background:linear-gradient(90deg,var(--user),#2366df); color:white; }

    .bubble .meta { display:block; font-size:0.78rem; color:var(--muted); margin-top:6px }

    .chat-popup .chat-input-row { display:flex; gap:8px; padding:12px; border-top:1px solid rgba(0,0,0,0.04); }
    .chat-input { flex:1; padding:10px 12px; border-radius:12px; border:1px solid #e3e6ee; background:#fff; box-shadow:inset 0 -1px 0 rgba(0,0,0,0.02); }
    .chat-send { padding:10px 14px; border-radius:10px; border:none; background:var(--accent); color:#fff; cursor:pointer; min-width:64px }

    .suggestions { display:flex; gap:10px; padding:10px 12px; border-top:1px solid rgba(0,0,0,0.04); background:transparent; flex-wrap:nowrap; justify-content:flex-start; overflow-x:auto; -webkit-overflow-scrolling:touch; }
    .suggestions::-webkit-scrollbar { height:0px; }
    .suggestions { scrollbar-width: none; -ms-overflow-style: none; }

    .suggest-btn { display:inline-flex; align-items:center; gap:8px; border:1px solid rgba(11,27,58,0.08); background:#fff; padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:700; font-size:0.86rem; flex:0 0 auto; white-space:nowrap; }
    .suggest-btn.primary { background:linear-gradient(90deg,#e6f0ff,#ffffff); border-color:var(--accent); color:var(--accent) }

    .chat-overlay.open { opacity: 1; background: rgba(8,12,20,0.35); }
    .chat-overlay.open .chat-popup { transform: scale(1); opacity: 1; }
    .chat-overlay[hidden] { display: none; }

    /* Grouped selector modal */
    .grouped-modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.28); display: none; z-index: 1600; align-items: center; justify-content: center; }
    .grouped-modal { width: 560px; max-width: calc(100% - 40px); background: var(--panel); border-radius: 12px; padding: 16px; box-shadow: 0 18px 40px rgba(8,20,40,0.25); }
    .grouped-modal h3 { margin: 0 0 8px 0; font-size:1.05rem; }
    .grouped-modal .cols-list { max-height: 340px; overflow:auto; border:1px solid #eef2f7; padding:8px; border-radius:8px; background:#fff; }
    .grouped-modal .cols-list label { display:flex; align-items:center; gap:8px; padding:6px 8px; border-radius:6px; cursor:pointer; }
    .grouped-modal .cols-list label:hover { background:#f8fbff; }
    .grouped-modal .modal-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:12px; }
    .grouped-modal .select-controls { display:flex; gap:8px; margin-bottom:8px; align-items:center; }

    @media (max-width:520px){ .grouped-modal{ width: 92%; } }

    @keyframes spin { 0%{ transform: rotate(0deg);} 100%{ transform: rotate(360deg);} }

    body.processing-ai { cursor: progress; }
    body.processing-ai .ai-fab { opacity: 0.9; }
    body.processing-ai .type-btn, body.processing-ai .suggest-btn, body.processing-ai .chat-send, body.processing-ai .chat-input { opacity: 0.85; }
